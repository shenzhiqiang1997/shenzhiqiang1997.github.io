<!DOCTYPE html>
<html>
  <!-- Html Head Tag-->
  <head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="no one">
  <!-- Open Graph Data -->
  <meta property="og:title" content="JVM工具"/>
  <meta property="og:description" content="" />
  <meta property="og:site_name" content="no one&#39;s blog"/>
  <meta property="og:type" content="article" />
  <meta property="og:image" content="http://henzhiqiang1997.github.io"/>
  
    <link rel="alternate" href="/atom.xml" title="no one&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  

  <!-- Site Title -->
  <title>no one's blog</title>

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="/css/bootstrap.min.css">
  <!-- Custom CSS -->
  
  <link rel="stylesheet" href="/css/style.light.css">

  <!-- Google Analytics -->
  

</head>

  <body>
    <!-- Page Header -->


<header class="site-header header-background" style="background-image: url(/img/default-banner-dark.jpg)">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="page-title with-background-image">
          <p class="title">JVM工具</p>
          <p class="subtitle"></p>
        </div>
        <div class="site-menu with-background-image">
          <ul>
            
              <li>
                <a href="/">
                  
                  Home
                  
                </a>
              </li>
            
              <li>
                <a href="/archives">
                  
                  Archives
                  
                </a>
              </li>
            
              <li>
                <a href="https://github.com/shenzhiqiang1997">
                  
                  Github
                  
                </a>
              </li>
            
              <li>
                <a href="mailto:1422537078@qq.com">
                  
                  Email
                  
                </a>
              </li>
            
          </ul>
        </div>
      </div>
    </div>
  </div>
</header>

<article>
  <div class="container typo">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-info text-muted">
          
            <!-- Author -->
            <span class="author info">By no one</span>
          
          <!-- Date -->
          <span class="date-time info">On
            <span class="date">2018-10-25</span>
            <span class="time">20:46:13</span>
          </span>
          
          <!--  Categories  -->
            <span class="categories info">Under 

<a href="/categories/JVM/">JVM</a>
</span>
          
        </div>
        <!-- Tags -->
        
          <div class="post-tags text-muted">
            Tags: 

<a class="tag" href="/tags/JVM/">#JVM</a> <a class="tag" href="/tags/工具/">#工具</a>


          </div>
        
        <!-- Post Main Content -->
        <div class="post-content">
          <h1 id="命令行工具"><a href="#命令行工具" class="headerlink" title="命令行工具"></a>命令行工具</h1><h2 id="jps"><a href="#jps" class="headerlink" title="jps"></a>jps</h2><p>即JVM Process Status Tools，用于查看虚拟机进程状态。<br>命令格式为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jps [option]</span><br></pre></td></tr></table></figure></p>
<a id="more"></a>
<h3 id="jps-1"><a href="#jps-1" class="headerlink" title="jps"></a>jps</h3><p>列出正在运行的虚拟机进程id以及它们执行的主类。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jps</span><br><span class="line">14804 Test</span><br><span class="line">6372</span><br><span class="line">14696 Jps</span><br><span class="line">18344 RemoteMavenServer</span><br><span class="line">3244 Launcher</span><br></pre></td></tr></table></figure></p>
<h3 id="jps-q"><a href="#jps-q" class="headerlink" title="jps -q"></a>jps -q</h3><p>省略虚拟机进程执行的主类，只列出正在运行的虚拟机进程id。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jps -q</span><br><span class="line">14804</span><br><span class="line">6372</span><br><span class="line">18344</span><br><span class="line">19596</span><br><span class="line">3244</span><br></pre></td></tr></table></figure></p>
<h3 id="jps-l"><a href="#jps-l" class="headerlink" title="jps -l"></a>jps -l</h3><p>在jps的基础上，显示主类的全名。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">14804 priv.shen.javassist.Test</span><br><span class="line">21876 sun.tools.jps.Jps</span><br><span class="line">6372</span><br><span class="line">18344 org.jetbrains.idea.maven.server.RemoteMavenServer</span><br><span class="line">3244 org.jetbrains.jps.cmdline.Launcher</span><br></pre></td></tr></table></figure></p>
<h3 id="jps-m"><a href="#jps-m" class="headerlink" title="jps -m"></a>jps -m</h3><p>在jps的基础上补充虚拟机进程启动时传递给主类的参数。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">14804 Test</span><br><span class="line">6372</span><br><span class="line">16888 Jps -m</span><br><span class="line">18344 RemoteMavenServer</span><br><span class="line">3244 Launcher C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/annotations.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/httpclient-4</span><br><span class="line">.5.2.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/slf4j-api-1.7.10.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/log4j.jar;C:</span><br><span class="line">/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/snappy-in-java-0.5.1.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/util.jar;C:/Program</span><br><span class="line"> Files/JetBrains/IntelliJ IDEA 2018.1/lib/jna.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/idea_rt.jar;C:/Program Files/JetBrains/Intel</span><br><span class="line">liJ IDEA 2018.1/lib/jps-model.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/jna-platform.jar;C:/Program Files/JetBrains/IntelliJ IDEA 20</span><br><span class="line">18.1/lib/oro-2.0.8.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/aether-dependency-resolver.jar;C:/Program Files/JetBrains/IntelliJ IDEA</span><br><span class="line"> 2018.1/lib/httpcore-4.4.5.jar;C:/Program Files/JetBrains/IntelliJ IDEA 2018.1/lib/netty-all-4.1.13.Final.jar;C:/Program Files/</span><br></pre></td></tr></table></figure></p>
<h3 id="jps-v"><a href="#jps-v" class="headerlink" title="jps -v"></a>jps -v</h3><p>在jps的基础上，补充虚拟机进程启动时的JVM参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jps -v</span><br><span class="line">14804 Test -javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\lib\idea_rt.jar=56883:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\bin -D</span><br><span class="line">file.encoding=UTF-8</span><br><span class="line">6372  -Xms128m -Xmx750m -XX:ReservedCodeCacheSize=240m -XX:+UseConcMarkSweepGC -XX:SoftRefLRUPolicyMSPerMB=50 -ea -Dsun.io.useCanonCaches=<span class="literal">false</span> -D</span><br><span class="line">java.net.preferIPv4Stack=<span class="literal">true</span> -XX:+HeapDumpOnOutOfMemoryError -XX:-OmitStackTraceInFastThrow -Djb.vmOptionsFile=C:\Program Files\JetBrains\Intelli</span><br><span class="line">J IDEA 2018.1\bin\idea64.exe.vmoptions -Didea.jre.check=<span class="literal">true</span> -Dide.native.launcher=<span class="literal">true</span> -Didea.paths.selector=IntelliJIdea2018.1 -XX:ErrorFile=C:\</span><br><span class="line">Users\14225\java_error_in_idea_%p.log -XX:HeapDumpPath=C:\Users\14225\java_error_in_idea.hprof</span><br><span class="line">18344 RemoteMavenServer -Djava.awt.headless=<span class="literal">true</span> -Didea.version==2018.1 -Xmx1024m -Didea.maven.embedder.version=3.3.9 -Dfile.encoding=GBK</span><br><span class="line">1756 Jps -Denv.class.path=C:\Program Files\Java\jdk1.8.0_161\lib\tools.jar; -Dapplication.home=C:\Program Files\Java\jdk1.8.0_161 -Xms8m</span><br><span class="line">3244 Launcher -Xmx700m -Djava.awt.headless=<span class="literal">true</span> -Djava.endorsed.dirs=<span class="string">""</span> -Djdt.compiler.useSingleThread=<span class="literal">true</span> -Dpreload.project.path=C:/Users/14225/</span><br><span class="line">IdeaProjects/Code -Dpreload.config.path=C:/Users/14225/.IntelliJIdea2018.1/config/options -Dexternal.project.config=C:\Users\14225\.IntelliJIdea20</span><br><span class="line">18.1\system\external_build_system\code.982f4335 -Dcompile.parallel=<span class="literal">false</span> -Drebuild.on.dependency.change=<span class="literal">true</span> -Djava.net.preferIPv4Stack=<span class="literal">true</span> -Dio.</span><br><span class="line">netty.initialSeedUniquifier=-5105987098425341563 -Dfile.encoding=GBK -Duser.language=zh -Duser.country=CN -Didea.paths.selector=IntelliJIdea2018.1</span><br><span class="line"> -Didea.home.path=C:\Program Files\JetBrains\IntelliJ IDEA 2018.1 -Didea.config.path=C:\Users\14225\.IntelliJIdea2018.1\config -Didea.plugins.path</span><br><span class="line">=C:\Users\14225\.IntelliJIdea2018.1\config\plugins -Djps.log.dir=C:/Users/14225/.IntelliJIdea2018.1/system/<span class="built_in">log</span>/build-log -Djps.fallback.jdk.home=C</span><br><span class="line">:/Program Files/JetBrains/IntelliJ IDEA 2018.1/jre64 -Djps.fallback.jdk.version=1.8.0_152-release -Dio.netty.noUnsafe=<span class="literal">true</span> -Djava.io.tmpdir=C:/Use</span><br><span class="line">rs/14225/.Intell</span><br></pre></td></tr></table></figure></p>
<h2 id="jstat"><a href="#jstat" class="headerlink" title="jstat"></a>jstat</h2><p>即JVM Statistics-Monitoring Tools，用于监控虚拟机运行信息，<br>包括类加载，内存，垃圾回收和运行时编译的状况。<br>命令格式为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstat option vimid [interval][s|ms] [count]</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-class-vmid"><a href="#jstat-class-vmid" class="headerlink" title="jstat -class vmid"></a>jstat -class vmid</h3><p>查看类加载，卸载的情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -class 14804</span><br><span class="line">Loaded  Bytes  Unloaded   Bytes       Time</span><br><span class="line">   558  1128.9        0     0.0       0.11</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gc-vmid"><a href="#jstat-gc-vmid" class="headerlink" title="jstat -gc vmid"></a>jstat -gc vmid</h3><p>查看各分区的容量以及使用情况，和GC耗时。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gc 14804</span><br><span class="line"> S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">5120.0 5120.0  0.0    0.0   33280.0   5327.2   87552.0      0.0     4480.0 770.9  384.0   75.9       0    0.000   0      0.000    0.000</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gccapacity-vmid"><a href="#jstat-gccapacity-vmid" class="headerlink" title="jstat -gccapacity vmid"></a>jstat -gccapacity vmid</h3><p>查看堆各分区的最大和最小容量以及GC次数。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gccapacity 14804</span><br><span class="line"> NGCMN    NGCMX     NGC     S0C   S1C       EC      OGCMN      OGCMX       OGC         OC       MCMN     MCMX      MC     CCSMN    CCSMX     CCSC</span><br><span class="line"> 43520.0 689152.0  43520.0 5120.0 5120.0  33280.0    87552.0  1379328.0    87552.0    87552.0    0.0   1056768.0   4480.0   0.0   1048576.0  384.0</span><br><span class="line"> YGC    FGC</span><br><span class="line">  0      0</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gcutil-vmid"><a href="#jstat-gcutil-vmid" class="headerlink" title="jstat -gcutil vmid"></a>jstat -gcutil vmid</h3><p>查看各分区的使用百分比，以及GC的次数和耗时。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gcutil 14804</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT</span><br><span class="line">  0.00   0.00  16.01   0.00  17.21  19.76      0    0.000     0    0.000    0.000</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gccause-vmid"><a href="#jstat-gccause-vmid" class="headerlink" title="jstat -gccause vmid"></a>jstat -gccause vmid</h3><p>在jstat -gcutil的基础上补充上次GC的原因。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gccause 14804</span><br><span class="line">  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC</span><br><span class="line">  0.00   0.00  16.01   0.00  17.21  19.76      0    0.000     0    0.000    0.000 No GC                No GC</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gcnew-vmid"><a href="#jstat-gcnew-vmid" class="headerlink" title="jstat -gcnew vmid"></a>jstat -gcnew vmid</h3><p>查看新生代内存使用情况和GC情况。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gcnew 14804</span><br><span class="line"> S0C    S1C    S0U    S1U   TT MTT  DSS      EC       EU     YGC     YGCT</span><br><span class="line">5120.0 5120.0    0.0    0.0 15  15    0.0  33280.0   5327.2      0    0.000</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gcnewcapacity-vmid"><a href="#jstat-gcnewcapacity-vmid" class="headerlink" title="jstat -gcnewcapacity vmid"></a>jstat -gcnewcapacity vmid</h3><p>与jstat -gcnew类似，只不过监控的是新生代内存的最大最小空间。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gcnewcapacity 14804</span><br><span class="line">  NGCMN      NGCMX       NGC      S0CMX     S0C     S1CMX     S1C       ECMX        EC      YGC   FGC</span><br><span class="line">   43520.0   689152.0    43520.0 229376.0   5120.0 229376.0   5120.0   688128.0    33280.0     0     0</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gcold-vmid"><a href="#jstat-gcold-vmid" class="headerlink" title="jstat -gcold vmid"></a>jstat -gcold vmid</h3><p>与jstat -gcnew类似，只不过是监控的老年代<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gcold 14804</span><br><span class="line">   MC       MU      CCSC     CCSU       OC          OU       YGC    FGC    FGCT     GCT</span><br><span class="line">  4480.0    770.9    384.0     75.9     87552.0         0.0      0     0    0.000    0.000</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-gcoldcapacity-vmid"><a href="#jstat-gcoldcapacity-vmid" class="headerlink" title="jstat -gcoldcapacity vmid"></a>jstat -gcoldcapacity vmid</h3><p>与jstat -gcnewcapacity类似，只不过是监控的是老年代<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -gcoldcapacity 14804</span><br><span class="line">   OGCMN       OGCMX        OGC         OC       YGC   FGC    FGCT     GCT</span><br><span class="line">    87552.0   1379328.0     87552.0     87552.0     0     0    0.000    0.000</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-compiler-vmid"><a href="#jstat-compiler-vmid" class="headerlink" title="jstat -compiler vmid"></a>jstat -compiler vmid</h3><p>输出JIT编译器编译过的方法以及耗时情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -compiler 14804</span><br><span class="line">Compiled Failed Invalid   Time   FailedType FailedMethod</span><br><span class="line">      62      0       0     0.04          0</span><br></pre></td></tr></table></figure></p>
<h3 id="jstat-printcompilation-vmid"><a href="#jstat-printcompilation-vmid" class="headerlink" title="jstat -printcompilation vmid"></a>jstat -printcompilation vmid</h3><p>输出JIT编译器编译过的方法<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstat -printcompilation 14804</span><br><span class="line">Compiled  Size  Type Method</span><br><span class="line">      62     63    1 java/lang/ThreadGroup threadTerminated</span><br></pre></td></tr></table></figure></p>
<h2 id="jinfo"><a href="#jinfo" class="headerlink" title="jinfo"></a>jinfo</h2><p>即Java Configuration Info，用于查看和修改虚拟机个各项配置参数。<br>命令格式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jinfo [option] vmid</span><br></pre></td></tr></table></figure></p>
<h3 id="jinfo-flags-vmid"><a href="#jinfo-flags-vmid" class="headerlink" title="jinfo -flags vmid"></a>jinfo -flags vmid</h3><p>输出虚拟机进程的各项JVM参数（非默认，要想查看默认参数要用jinfo -flag name），而jps -v只能显示出显式指定的JVM参数。<br>这个是jinfo -flags 显示的JVM参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jinfo -flags 14804</span><br><span class="line">Attaching to process ID 14804, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line">Non-default VM flags: -XX:CICompilerCount=4 -XX:InitialHeapSize=134217728 -XX:MaxHeapSize=2118123520 -XX:MaxNewSize=705691648 -XX:MinHeapDeltaByte</span><br><span class="line">s=524288 -XX:NewSize=44564480 -XX:OldSize=89653248 -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseFastUnorderedTimeStamps -XX:-Use</span><br><span class="line">LargePagesIndividualAllocation -XX:+UseParallelGC</span><br><span class="line">Command line:  -javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\lib\idea_rt.jar=56883:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\bi</span><br><span class="line">n -Dfile.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<p>而这个是jps -v 显示的JVM参数<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">14804 Test -javaagent:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\lib\idea_rt.jar=56883:C:\Program Files\JetBrains\IntelliJ IDEA 2018.1\bin -D</span><br><span class="line">file.encoding=UTF-8</span><br></pre></td></tr></table></figure></p>
<h3 id="jinfo-flag-name-value-vmid"><a href="#jinfo-flag-name-value-vmid" class="headerlink" title="jinfo -flag name=value vmid"></a>jinfo -flag name=value vmid</h3><p>修改虚拟机进程的某项参数，注意只有一部分参数允许运行时修改，这里修改的是使当OOM时做堆快照转储快照的参数生效。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jinfo -flag HeapDumpOnOutOfMemoryError=1 14804</span><br></pre></td></tr></table></figure></p>
<h3 id="jinfo-systprops-vmid"><a href="#jinfo-systprops-vmid" class="headerlink" title="jinfo -systprops vmid"></a>jinfo -systprops vmid</h3><p>输出虚拟机进程的各项java系统属性<br>这里比较多，只列出了一部分<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">:\Users\14225\IdeaProjects\Code&gt;jinfo -sysprops 14804</span><br><span class="line">Attaching to process ID 14804, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line">java.runtime.name = Java(TM) SE Runtime Environment</span><br><span class="line">java.vm.version = 25.161-b12</span><br><span class="line">sun.boot.library.path = C:\Program Files\Java\jdk1.8.0_161\jre\bin</span><br><span class="line">java.vendor.url = http://java.oracle.com/</span><br><span class="line">java.vm.vendor = Oracle Corporation</span><br><span class="line">path.separator = ;</span><br><span class="line">file.encoding.pkg = sun.io</span><br><span class="line">java.vm.name = Java HotSpot(TM) 64-Bit Server VM</span><br><span class="line">sun.os.patch.level =</span><br><span class="line">sun.java.launcher = SUN_STANDARD</span><br></pre></td></tr></table></figure></p>
<h2 id="jmap"><a href="#jmap" class="headerlink" title="jmap"></a>jmap</h2><p>即Java Memory Map，用于生成堆转储快照（headdump)，或者是查看finalize执行队列，堆、永久代的详细信息。<br>命令格式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap [option] vmid</span><br></pre></td></tr></table></figure></p>
<h3 id="jmap-dump-vimid"><a href="#jmap-dump-vimid" class="headerlink" title="jmap -dump vimid"></a>jmap -dump vimid</h3><p>生成堆转储快照。<br>命令格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jmap -dump:[live],format=b,file=&lt;filename&gt; vmid</span><br></pre></td></tr></table></figure></p>
<p>其中live表示只选择存活对象进行dump，format=b指以二进制文件的形式输出，file=<filename>指定输出的文件名称。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jmap -dump:live,format=b,file=dump.bin 14804</span><br><span class="line">Dumping heap to C:\Users\14225\IdeaProjects\Code\dump.bin ...</span><br><span class="line">Heap dump file created</span><br></pre></td></tr></table></figure></filename></p>
<p>后续需要用jhat来对dump进行分析，到时候一起讲。</p>
<h3 id="jmap-finalizerinfo-vmid"><a href="#jmap-finalizerinfo-vmid" class="headerlink" title="jmap -finalizerinfo vmid"></a>jmap -finalizerinfo vmid</h3><p>查看finalize执行队列<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jmap -finalizerinfo 14804</span><br><span class="line">Attaching to process ID 14804, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line">Number of objects pending <span class="keyword">for</span> finalization: 0</span><br></pre></td></tr></table></figure></p>
<h3 id="jmap-heap-vmid"><a href="#jmap-heap-vmid" class="headerlink" title="jmap -heap vmid"></a>jmap -heap vmid</h3><p>查看堆的配置情况和使用情况<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jmap -heap 14804</span><br><span class="line">Attaching to process ID 14804, please <span class="built_in">wait</span>...</span><br><span class="line">Debugger attached successfully.</span><br><span class="line">Server compiler detected.</span><br><span class="line">JVM version is 25.161-b12</span><br><span class="line"></span><br><span class="line">using thread-local object allocation.</span><br><span class="line">Parallel GC with 8 thread(s)</span><br><span class="line"></span><br><span class="line">Heap Configuration:</span><br><span class="line">   MinHeapFreeRatio         = 0</span><br><span class="line">   MaxHeapFreeRatio         = 100</span><br><span class="line">   MaxHeapSize              = 2118123520 (2020.0MB)</span><br><span class="line">   NewSize                  = 44564480 (42.5MB)</span><br><span class="line">   MaxNewSize               = 705691648 (673.0MB)</span><br><span class="line">   OldSize                  = 89653248 (85.5MB)</span><br><span class="line">   NewRatio                 = 2</span><br><span class="line">   SurvivorRatio            = 8</span><br><span class="line">   MetaspaceSize            = 21807104 (20.796875MB)</span><br><span class="line">   CompressedClassSpaceSize = 1073741824 (1024.0MB)</span><br><span class="line">   MaxMetaspaceSize         = 17592186044415 MB</span><br><span class="line">   G1HeapRegionSize         = 0 (0.0MB)</span><br><span class="line"></span><br><span class="line">Heap Usage:</span><br><span class="line">PS Young Generation</span><br><span class="line">Eden Space:</span><br><span class="line">   capacity = 34078720 (32.5MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 34078720 (32.5MB)</span><br><span class="line">   0.0% used</span><br><span class="line">From Space:</span><br><span class="line">   capacity = 5242880 (5.0MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 5242880 (5.0MB)</span><br><span class="line">   0.0% used</span><br><span class="line">To Space:</span><br><span class="line">   capacity = 5242880 (5.0MB)</span><br><span class="line">   used     = 0 (0.0MB)</span><br><span class="line">   free     = 5242880 (5.0MB)</span><br><span class="line">   0.0% used</span><br><span class="line">PS Old Generation</span><br><span class="line">   capacity = 35651584 (34.0MB)</span><br><span class="line">   used     = 1378752 (1.31488037109375MB)</span><br><span class="line">   free     = 34272832 (32.68511962890625MB)</span><br><span class="line">   3.8672952090992645% used</span><br><span class="line"></span><br><span class="line">1693 interned Strings occupying 153240 bytes.</span><br></pre></td></tr></table></figure></p>
<h3 id="jmap-histo-vmid"><a href="#jmap-histo-vmid" class="headerlink" title="jmap -histo vmid"></a>jmap -histo vmid</h3><p>查看堆中的对象信息。<br>这里只选择了存活的对象。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jmap -histo:live 14804</span><br><span class="line"></span><br><span class="line"> num     <span class="comment">#instances         #bytes  class name</span></span><br><span class="line">----------------------------------------------</span><br><span class="line">   1:          1169         439544  java.lang.Thread</span><br><span class="line">   2:          3935         408408  [C</span><br><span class="line">   3:          3785          90840  java.lang.String</span><br><span class="line">   4:           641          73176  java.lang.Class</span><br><span class="line">   5:          1174          46960  java.security.AccessControlContext</span><br><span class="line">   6:           606          35136  [Ljava.lang.Object;</span><br><span class="line">   7:            26          33672  [B</span><br><span class="line">   8:           791          31640  java.util.TreeMap<span class="variable">$Entry</span></span><br><span class="line">   9:          1162          27888  [Ljava.security.ProtectionDomain;</span><br><span class="line">  10:          1161          27864  priv.shen.javassist.Task</span><br><span class="line">  11:          1245          19920  java.lang.Object</span><br><span class="line">  12:           782          18768  java.util.LinkedList<span class="variable">$Node</span></span><br><span class="line">  13:           463          14816  java.util.HashMap<span class="variable">$Node</span></span><br><span class="line">  14:           394          12608  java.util.LinkedList</span><br><span class="line">  15:             2           8240  [Ljava.lang.Thread;</span><br><span class="line">  16:           202           8136  [Ljava.lang.String;</span><br><span class="line">  17:            21           6032  [Ljava.util.HashMap<span class="variable">$Node</span>;</span><br><span class="line">  18:           115           4904  [I</span><br><span class="line">  19:            75           4800  java.net.URL</span><br><span class="line">  20:           150           4800  java.util.Hashtable<span class="variable">$Entry</span></span><br><span class="line">  21:           103           4120  java.lang.ref.SoftReference</span><br><span class="line">  22:           256           4096  java.lang.Integer</span><br><span class="line">  23:            90           2880  java.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span></span><br><span class="line">  24:            37           2072  sun.misc.URLClassPath<span class="variable">$JarLoader</span></span><br><span class="line">  25:            38           1824  sun.util.locale.LocaleObjectCache<span class="variable">$CacheEntry</span></span><br><span class="line">  26:            22           1760  java.lang.reflect.Constructor</span><br><span class="line">  27:            40           1600  java.util.LinkedHashMap<span class="variable">$Entry</span></span><br><span class="line">  28:            37           1480  java.io.ObjectStreamField</span><br><span class="line">  29:            18           1440  [Ljava.util.WeakHashMap<span class="variable">$Entry</span>;</span><br><span class="line">  30:            27           1296  java.util.HashMap</span><br><span class="line">  31:             8           1264  [Ljava.util.Hashtable<span class="variable">$Entry</span>;</span><br><span class="line">  32:            27           1080  java.lang.ref.Finalizer</span><br><span class="line">  33:             2           1064  [Ljava.lang.invoke.MethodHandle;</span><br><span class="line">  34:             1           1040  [Ljava.lang.Integer;</span><br><span class="line">  35:             1           1040  [[C</span><br><span class="line">  36:            40            960  java.io.ExpiringCache<span class="variable">$Entry</span></span><br><span class="line">  37:            15            960  java.util.jar.JarFile</span><br><span class="line">  38:            17            952  sun.nio.cs.UTF_8<span class="variable">$Encoder</span></span><br><span class="line">  39:             5            912  [Ljava.util.concurrent.ConcurrentHashMap<span class="variable">$Node</span>;</span><br><span class="line">  40:            18            864  java.util.WeakHashMap</span><br><span class="line">  41:             8            768  java.util.jar.JarFile<span class="variable">$JarFileEntry</span></span><br><span class="line">  42:            19            760  sun.util.locale.BaseLocale<span class="variable">$Key</span></span><br><span class="line">  43:            22            704  java.lang.ref.ReferenceQueue</span><br><span class="line">  44:             8            640  [S</span><br><span class="line">  45:            19            608  java.util.Locale</span><br><span class="line">  46:            19            608  sun.util.locale.BaseLocale</span><br><span class="line">  47:            15            480  java.util.zip.ZipCoder</span><br><span class="line">  48:            19            456  java.util.Locale<span class="variable">$LocaleKey</span></span><br><span class="line">  49:             7            448  java.util.concurrent.ConcurrentHashMap</span><br><span class="line">  50:            11            440  sun.nio.cs.UTF_8<span class="variable">$Decoder</span></span><br><span class="line">  51:            17            408  java.util.jar.Attributes<span class="variable">$Name</span></span><br><span class="line">  52:            13            392  [Ljava.io.ObjectStreamField;</span><br><span class="line">  53:             1            384  com.intellij.rt.execution.application.AppMainV2<span class="variable">$1</span></span><br><span class="line">  54:            12            384  java.io.File</span><br><span class="line">  55:             1            384  java.lang.ref.Finalizer<span class="variable">$FinalizerThread</span></span><br><span class="line">  56:            24            384  java.lang.ref.ReferenceQueue<span class="variable">$Lock</span></span><br><span class="line">  57:             6            384  java.nio.DirectByteBuffer</span><br><span class="line">  58:             1            376  java.lang.ref.Reference<span class="variable">$ReferenceHandler</span></span><br><span class="line">  59:            15            360  java.util.ArrayDeque</span><br><span class="line">  60:             6            336  java.nio.DirectLongBufferU</span><br><span class="line">  61:            10            320  java.lang.OutOfMemoryError</span><br><span class="line">  62:             3            312  [D</span><br><span class="line">  63:            12            288  java.util.ArrayList</span><br><span class="line">  64:            11            264  sun.misc.MetaIndex</span><br><span class="line">  65:            11            264  sun.reflect.NativeConstructorAccessorImpl</span><br><span class="line">  66:             5            200  java.util.WeakHashMap<span class="variable">$Entry</span></span><br><span class="line">  67:            12            192  [Ljava.lang.Class;</span><br><span class="line">  68:             4            192  java.util.Hashtable</span><br><span class="line">  69:             4            192  java.util.Properties</span><br><span class="line">  70:             4            192  java.util.TreeMap</span><br><span class="line">  71:             6            192  java.util.Vector</span><br><span class="line">  72:            11            176  sun.reflect.DelegatingConstructorAccessorImpl</span><br><span class="line">  73:             4            160  java.io.FileDescriptor</span><br><span class="line">  74:             4            160  java.lang.ClassLoader<span class="variable">$NativeLibrary</span></span><br><span class="line">  75:             4            160  java.security.ProtectionDomain</span><br><span class="line">  76:             3            144  java.nio.HeapByteBuffer</span><br><span class="line">  77:             2            144  java.util.regex.Pattern</span><br><span class="line">  78:             3            144  java.util.zip.Inflater</span><br><span class="line">  79:             6            144  sun.misc.PerfCounter</span><br><span class="line">  80:             6            144  sun.security.util.DisabledAlgorithmConstraints<span class="variable">$Constraint</span><span class="variable">$Operator</span></span><br><span class="line">  81:             2            128  java.io.ExpiringCache<span class="variable">$1</span></span><br><span class="line">  82:             4            128  java.security.CodeSource</span><br><span class="line">  83:             1            120  java.net.SocksSocketImpl</span><br><span class="line">  84:             5            120  sun.misc.FloatingDecimal<span class="variable">$PreparedASCIIToBinaryBuffer</span></span><br><span class="line">  85:             2            112  java.lang.Package</span><br><span class="line">  86:             2            112  java.util.LinkedHashMap</span><br><span class="line">  87:             4             96  java.lang.RuntimePermission</span><br><span class="line">  88:             2             96  java.lang.ThreadGroup</span><br><span class="line">  89:             3             96  java.util.Stack</span><br><span class="line">  90:             1             96  sun.misc.Launcher<span class="variable">$AppClassLoader</span></span><br><span class="line">  91:             2             96  sun.misc.URLClassPath</span><br><span class="line">  92:             3             96  sun.net.spi.DefaultProxySelector<span class="variable">$NonProxyInfo</span></span><br><span class="line">  93:             2             96  sun.nio.cs.StreamEncoder</span><br><span class="line">  94:             1             88  java.net.DualStackPlainSocketImpl</span><br><span class="line">  95:             1             88  sun.misc.Launcher<span class="variable">$ExtClassLoader</span></span><br><span class="line">  96:             1             80  [Ljava.lang.ThreadLocal<span class="variable">$ThreadLocalMap</span><span class="variable">$Entry</span>;</span><br><span class="line">  97:             2             80  java.io.BufferedWriter</span><br><span class="line">  98:             2             80  java.io.ExpiringCache</span><br><span class="line">  99:             5             80  java.lang.ThreadLocal</span><br><span class="line"> 100:             2             80  sun.misc.FloatingDecimal<span class="variable">$BinaryToASCIIBuffer</span></span><br><span class="line"> 101:             2             80  sun.security.util.DisabledAlgorithmConstraints<span class="variable">$KeySizeConstraint</span></span><br><span class="line"> 102:             3             72  java.net.Proxy<span class="variable">$Type</span></span><br><span class="line"> 103:             3             72  java.util.Collections<span class="variable">$SynchronizedSet</span></span><br><span class="line"> 104:             3             72  java.util.concurrent.atomic.AtomicLong</span><br><span class="line"> 105:             3             72  java.util.zip.ZStreamRef</span><br><span class="line"> 106:             3             72  sun.misc.FloatingDecimal<span class="variable">$ExceptionalBinaryToASCIIBuffer</span></span><br><span class="line"> 107:             3             72  sun.misc.JarIndex</span><br><span class="line"> 108:             1             64  [F</span><br><span class="line"> 109:             4             64  [Ljava.security.Principal;</span><br><span class="line"> 110:             2             64  java.io.FileOutputStream</span><br><span class="line"> 111:             2             64  java.io.FilePermission</span><br><span class="line"> 112:             2             64  java.io.PrintStream</span><br><span class="line"> 113:             2             64  java.lang.ClassValue<span class="variable">$Entry</span></span><br><span class="line"> 114:             2             64  java.lang.VirtualMachineError</span><br><span class="line"> 115:             2             64  java.lang.ref.ReferenceQueue<span class="variable">$Null</span></span><br><span class="line"> 116:             2             64  java.security.BasicPermissionCollection</span><br><span class="line"> 117:             2             64  java.security.Permissions</span><br><span class="line"> 118:             4             64  java.security.ProtectionDomain<span class="variable">$Key</span></span><br><span class="line"> 119:             1             48  [J</span><br><span class="line"> 120:             2             48  java.io.BufferedOutputStream</span><br><span class="line"> 121:             1             48  java.io.BufferedReader</span><br><span class="line"> 122:             2             48  java.io.File<span class="variable">$PathStatus</span></span><br><span class="line"> 123:             2             48  java.io.FilePermissionCollection</span><br><span class="line"> 124:             2             48  java.io.OutputStreamWriter</span><br><span class="line"> 125:             2             48  java.net.InetAddress<span class="variable">$Cache</span></span><br><span class="line"> 126:             2             48  java.net.InetAddress<span class="variable">$Cache</span><span class="variable">$Type</span></span><br><span class="line"> 127:             1             48  java.net.SocketInputStream</span><br><span class="line"> 128:             1             48  java.nio.HeapCharBuffer</span><br><span class="line"> 129:             2             48  java.nio.charset.CoderResult</span><br><span class="line"> 130:             3             48  java.nio.charset.CodingErrorAction</span><br><span class="line"> 131:             2             48  java.util.regex.Pattern<span class="variable">$SliceI</span></span><br><span class="line"> 132:             2             48  java.util.regex.Pattern<span class="variable">$Start</span></span><br><span class="line"> 133:             2             48  sun.misc.NativeSignalHandler</span><br><span class="line"> 134:             2             48  sun.misc.Signal</span><br><span class="line"> 135:             1             48  sun.nio.cs.StreamDecoder</span><br><span class="line"> 136:             1             48  sun.nio.cs.US_ASCII<span class="variable">$Decoder</span></span><br><span class="line"> 137:             2             48  sun.security.util.DisabledAlgorithmConstraints<span class="variable">$DisabledConstraint</span></span><br><span class="line"> 138:             1             40  [Lsun.security.util.DisabledAlgorithmConstraints<span class="variable">$Constraint</span><span class="variable">$Operator</span>;</span><br><span class="line"> 139:             1             40  [[Ljava.lang.String;</span><br><span class="line"> 140:             1             40  java.io.BufferedInputStream</span><br><span class="line"> 141:             1             40  sun.nio.cs.StandardCharsets<span class="variable">$Aliases</span></span><br><span class="line"> 142:             1             40  sun.nio.cs.StandardCharsets<span class="variable">$Cache</span></span><br><span class="line"> 143:             1             40  sun.nio.cs.StandardCharsets<span class="variable">$Classes</span></span><br><span class="line"> 144:             1             40  sun.nio.cs.ext.ExtendedCharsets</span><br><span class="line"> 145:             1             32  [Ljava.lang.OutOfMemoryError;</span><br><span class="line"> 146:             2             32  [Ljava.lang.StackTraceElement;</span><br><span class="line"> 147:             1             32  [Ljava.lang.ThreadGroup;</span><br><span class="line"> 148:             1             32  [Ljava.net.Proxy<span class="variable">$Type</span>;</span><br><span class="line"> 149:             1             32  java.io.FileInputStream</span><br><span class="line"> 150:             1             32  java.io.WinNTFileSystem</span><br><span class="line"> 151:             1             32  java.lang.ArithmeticException</span><br><span class="line"> 152:             2             32  java.lang.Boolean</span><br><span class="line"> 153:             1             32  java.lang.NullPointerException</span><br><span class="line"> 154:             1             32  java.lang.ThreadLocal<span class="variable">$ThreadLocalMap</span><span class="variable">$Entry</span></span><br><span class="line"> 155:             1             32  java.net.InetAddress<span class="variable">$InetAddressHolder</span></span><br><span class="line"> 156:             1             32  java.net.Socket</span><br><span class="line"> 157:             2             32  java.nio.ByteOrder</span><br><span class="line"> 158:             2             32  java.util.HashSet</span><br><span class="line"> 159:             2             32  java.util.concurrent.atomic.AtomicInteger</span><br><span class="line"> 160:             1             32  java.util.concurrent.atomic.AtomicReferenceFieldUpdater<span class="variable">$AtomicReferenceFieldUpdaterImpl</span></span><br><span class="line"> 161:             1             32  java.util.regex.Pattern<span class="variable">$Branch</span></span><br><span class="line"> 162:             1             32  sun.instrument.InstrumentationImpl</span><br><span class="line"> 163:             2             32  sun.net.www.protocol.jar.Handler</span><br><span class="line"> 164:             1             32  sun.nio.cs.StandardCharsets</span><br><span class="line"> 165:             1             24  [Ljava.io.File<span class="variable">$PathStatus</span>;</span><br><span class="line"> 166:             1             24  [Ljava.lang.ClassValue<span class="variable">$Entry</span>;</span><br><span class="line"> 167:             1             24  [Ljava.net.InetAddress<span class="variable">$Cache</span><span class="variable">$Type</span>;</span><br><span class="line"> 168:             1             24  [Ljava.util.regex.Pattern<span class="variable">$Node</span>;</span><br><span class="line"> 169:             1             24  [Lsun.launcher.LauncherHelper;</span><br><span class="line"> 170:             1             24  java.io.InputStreamReader</span><br><span class="line"> 171:             1             24  java.lang.ClassValue<span class="variable">$Version</span></span><br><span class="line"> 172:             1             24  java.lang.StringBuilder</span><br><span class="line"> 173:             1             24  java.lang.ThreadLocal<span class="variable">$ThreadLocalMap</span></span><br><span class="line"> 174:             1             24  java.lang.invoke.MethodHandleImpl<span class="variable">$4</span></span><br><span class="line"> 175:             1             24  java.lang.reflect.ReflectPermission</span><br><span class="line"> 176:             1             24  java.net.Inet4Address</span><br><span class="line"> 177:             1             24  java.net.Inet6AddressImpl</span><br><span class="line"> 178:             1             24  java.net.Proxy</span><br><span class="line"> 179:             1             24  java.util.BitSet</span><br><span class="line"> 180:             1             24  java.util.Collections<span class="variable">$EmptyMap</span></span><br><span class="line"> 181:             1             24  java.util.Collections<span class="variable">$SetFromMap</span></span><br><span class="line"> 182:             1             24  java.util.Collections<span class="variable">$UnmodifiableRandomAccessList</span></span><br><span class="line"> 183:             1             24  java.util.Locale<span class="variable">$Cache</span></span><br><span class="line"> 184:             1             24  java.util.regex.Pattern<span class="variable">$Single</span></span><br><span class="line"> 185:             1             24  sun.instrument.TransformerManager</span><br><span class="line"> 186:             1             24  sun.launcher.LauncherHelper</span><br><span class="line"> 187:             1             24  sun.misc.URLClassPath<span class="variable">$FileLoader</span></span><br><span class="line"> 188:             1             24  sun.nio.cs.ISO_8859_1</span><br><span class="line"> 189:             1             24  sun.nio.cs.ThreadLocalCoders<span class="variable">$1</span></span><br><span class="line"> 190:             1             24  sun.nio.cs.ThreadLocalCoders<span class="variable">$2</span></span><br><span class="line"> 191:             1             24  sun.nio.cs.US_ASCII</span><br><span class="line"> 192:             1             24  sun.nio.cs.UTF_16</span><br><span class="line"> 193:             1             24  sun.nio.cs.UTF_16BE</span><br><span class="line"> 194:             1             24  sun.nio.cs.UTF_16LE</span><br><span class="line"> 195:             1             24  sun.nio.cs.UTF_8</span><br><span class="line"> 196:             1             24  sun.nio.cs.ext.GBK</span><br><span class="line"> 197:             1             24  sun.security.util.DisabledAlgorithmConstraints</span><br><span class="line"> 198:             1             24  sun.util.locale.BaseLocale<span class="variable">$Cache</span></span><br><span class="line"> 199:             1             16  [Ljava.lang.Throwable;</span><br><span class="line"> 200:             1             16  [Ljava.security.cert.Certificate;</span><br><span class="line"> 201:             1             16  [Lsun.instrument.TransformerManager<span class="variable">$TransformerInfo</span>;</span><br><span class="line"> 202:             1             16  java.io.FileDescriptor<span class="variable">$1</span></span><br><span class="line"> 203:             1             16  java.lang.CharacterDataLatin1</span><br><span class="line"> 204:             1             16  java.lang.ClassValue<span class="variable">$Identity</span></span><br><span class="line"> 205:             1             16  java.lang.Runtime</span><br><span class="line"> 206:             1             16  java.lang.String<span class="variable">$CaseInsensitiveComparator</span></span><br><span class="line"> 207:             1             16  java.lang.System<span class="variable">$2</span></span><br><span class="line"> 208:             1             16  java.lang.Terminator<span class="variable">$1</span></span><br><span class="line"> 209:             1             16  java.lang.invoke.MemberName<span class="variable">$Factory</span></span><br><span class="line"> 210:             1             16  java.lang.invoke.MethodHandleImpl<span class="variable">$2</span></span><br><span class="line"> 211:             1             16  java.lang.invoke.MethodHandleImpl<span class="variable">$3</span></span><br><span class="line"> 212:             1             16  java.lang.ref.Reference<span class="variable">$1</span></span><br><span class="line"> 213:             1             16  java.lang.ref.Reference<span class="variable">$Lock</span></span><br><span class="line"> 214:             1             16  java.lang.reflect.ReflectAccess</span><br><span class="line"> 215:             1             16  java.net.InetAddress<span class="variable">$2</span></span><br><span class="line"> 216:             1             16  java.net.URLClassLoader<span class="variable">$7</span></span><br><span class="line"> 217:             1             16  java.nio.Bits<span class="variable">$1</span></span><br><span class="line"> 218:             1             16  java.nio.charset.CoderResult<span class="variable">$1</span></span><br><span class="line"> 219:             1             16  java.nio.charset.CoderResult<span class="variable">$2</span></span><br><span class="line"> 220:             1             16  java.security.ProtectionDomain<span class="variable">$2</span></span><br><span class="line"> 221:             1             16  java.security.ProtectionDomain<span class="variable">$JavaSecurityAccessImpl</span></span><br><span class="line"> 222:             1             16  java.util.Collections<span class="variable">$EmptyList</span></span><br><span class="line"> 223:             1             16  java.util.Collections<span class="variable">$EmptySet</span></span><br><span class="line"> 224:             1             16  java.util.Hashtable<span class="variable">$EntrySet</span></span><br><span class="line"> 225:             1             16  java.util.WeakHashMap<span class="variable">$KeySet</span></span><br><span class="line"> 226:             1             16  java.util.concurrent.atomic.AtomicBoolean</span><br><span class="line"> 227:             1             16  java.util.jar.JavaUtilJarAccessImpl</span><br><span class="line"> 228:             1             16  java.util.regex.Pattern<span class="variable">$4</span></span><br><span class="line"> 229:             1             16  java.util.regex.Pattern<span class="variable">$BranchConn</span></span><br><span class="line"> 230:             1             16  java.util.regex.Pattern<span class="variable">$LastNode</span></span><br><span class="line"> 231:             1             16  java.util.regex.Pattern<span class="variable">$Node</span></span><br><span class="line"> 232:             1             16  java.util.zip.ZipFile<span class="variable">$1</span></span><br><span class="line"> 233:             1             16  sun.misc.ASCIICaseInsensitiveComparator</span><br><span class="line"> 234:             1             16  sun.misc.FloatingDecimal<span class="variable">$1</span></span><br><span class="line"> 235:             1             16  sun.misc.Launcher</span><br><span class="line"> 236:             1             16  sun.misc.Launcher<span class="variable">$Factory</span></span><br><span class="line"> 237:             1             16  sun.misc.Perf</span><br><span class="line"> 238:             1             16  sun.misc.Unsafe</span><br><span class="line"> 239:             1             16  sun.net.spi.DefaultProxySelector</span><br><span class="line"> 240:             1             16  sun.net.www.protocol.file.Handler</span><br><span class="line"> 241:             1             16  sun.reflect.ReflectionFactory</span><br><span class="line"> 242:             1             16  sun.security.util.AlgorithmDecomposer</span><br><span class="line"> 243:             1             16  sun.security.util.DisabledAlgorithmConstraints<span class="variable">$Constraints</span></span><br><span class="line">Total         19306        1371096</span><br></pre></td></tr></table></figure></p>
<h2 id="jhat"><a href="#jhat" class="headerlink" title="jhat"></a>jhat</h2><p>即Java Heap Analysis Tool，一般与jmap配合使用来分析堆转储快照。<br>命令格式<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jhat &lt;filename&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jhat dump.bin</span><br><span class="line">Reading from dump.bin...</span><br><span class="line">Dump file created Wed Oct 24 18:43:51 CST 2018</span><br><span class="line">Snapshot <span class="built_in">read</span>, resolving...</span><br><span class="line">Resolving 19387 objects...</span><br><span class="line">Chasing references, expect 3 dots...</span><br><span class="line">Eliminating duplicate references...</span><br><span class="line">Snapshot resolved.</span><br><span class="line">Started HTTP server on port 7000</span><br><span class="line">Server is ready.</span><br></pre></td></tr></table></figure>
<p>jhat会把分析结果以html的形式输出，打开<a href="http://localhost:7000即可查看" target="_blank" rel="noopener">http://localhost:7000即可查看</a></p>
<h2 id="jstack"><a href="#jstack" class="headerlink" title="jstack"></a>jstack</h2><p>即Java Stack Trace，用于生成虚拟机进程当前时刻的线程快照，分析线程快照中线程的调用堆栈来快速定位线程长时间停顿的原因，可以用来检测死锁（一般是死锁，死循环，请求外部资源时长时间等待）。<br>命令格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jstack [option] vmid</span><br></pre></td></tr></table></figure></p>
<h3 id="jstack-l-vimid"><a href="#jstack-l-vimid" class="headerlink" title="jstack -l vimid"></a>jstack -l vimid</h3><p>显示线程的调用堆栈，并且显示关于锁的信息。<br>我这里特地查看了一个死锁的程序的线程快照。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\14225\IdeaProjects\Code&gt;jstack -l 3516</span><br><span class="line">2018-10-24 19:29:51</span><br><span class="line">Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.161-b12 mixed mode):</span><br><span class="line"></span><br><span class="line"><span class="string">"DestroyJavaVM"</span> <span class="comment">#16 prio=5 os_prio=0 tid=0x0000000019b48000 nid=0x3d44 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Thread-3"</span> <span class="comment">#15 prio=5 os_prio=0 tid=0x0000000019b47800 nid=0x4d18 waiting for monitor entry [0x000000001aacf000]</span></span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:13)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Thread-2"</span> <span class="comment">#14 prio=5 os_prio=0 tid=0x0000000019b49000 nid=0x43f8 waiting for monitor entry [0x000000001a9cf000]</span></span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:13)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e80&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Thread-1"</span> <span class="comment">#13 prio=5 os_prio=0 tid=0x0000000019b46800 nid=0x2aec waiting for monitor entry [0x000000001a8cf000]</span></span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:19)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e80&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Thread-0"</span> <span class="comment">#12 prio=5 os_prio=0 tid=0x0000000019b46000 nid=0x541c waiting for monitor entry [0x000000001a7cf000]</span></span><br><span class="line">   java.lang.Thread.State: BLOCKED (on object monitor)</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:19)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d60b7e80&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Service Thread"</span> <span class="comment">#11 daemon prio=9 os_prio=0 tid=0x0000000019a34000 nid=0x5968 runnable [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"C1 CompilerThread3"</span> <span class="comment">#10 daemon prio=9 os_prio=2 tid=0x00000000199d0800 nid=0x4664 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"C2 CompilerThread2"</span> <span class="comment">#9 daemon prio=9 os_prio=2 tid=0x00000000199c1800 nid=0x2774 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"C2 CompilerThread1"</span> <span class="comment">#8 daemon prio=9 os_prio=2 tid=0x00000000199bd800 nid=0x1690 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"C2 CompilerThread0"</span> <span class="comment">#7 daemon prio=9 os_prio=2 tid=0x00000000199b8800 nid=0x3e20 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Monitor Ctrl-Break"</span> <span class="comment">#6 daemon prio=5 os_prio=0 tid=0x0000000019999000 nid=0x4ebc runnable [0x000000001a0ce000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line">        at java.net.SocketInputStream.socketRead0(Native Method)</span><br><span class="line">        at java.net.SocketInputStream.socketRead(SocketInputStream.java:116)</span><br><span class="line">        at java.net.SocketInputStream.read(SocketInputStream.java:171)</span><br><span class="line">        at java.net.SocketInputStream.read(SocketInputStream.java:141)</span><br><span class="line">        at sun.nio.cs.StreamDecoder.readBytes(StreamDecoder.java:284)</span><br><span class="line">        at sun.nio.cs.StreamDecoder.implRead(StreamDecoder.java:326)</span><br><span class="line">        at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:178)</span><br><span class="line">        - locked &lt;0x00000000d6133710&gt; (a java.io.InputStreamReader)</span><br><span class="line">        at java.io.InputStreamReader.read(InputStreamReader.java:184)</span><br><span class="line">        at java.io.BufferedReader.fill(BufferedReader.java:161)</span><br><span class="line">        at java.io.BufferedReader.readLine(BufferedReader.java:324)</span><br><span class="line">        - locked &lt;0x00000000d6133710&gt; (a java.io.InputStreamReader)</span><br><span class="line">        at java.io.BufferedReader.readLine(BufferedReader.java:389)</span><br><span class="line">        at com.intellij.rt.execution.application.AppMainV2<span class="variable">$1</span>.run(AppMainV2.java:64)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Attach Listener"</span> <span class="comment">#5 daemon prio=5 os_prio=2 tid=0x0000000019909000 nid=0x1c70 waiting on condition [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Signal Dispatcher"</span> <span class="comment">#4 daemon prio=9 os_prio=2 tid=0x0000000019960800 nid=0x3bd8 runnable [0x0000000000000000]</span></span><br><span class="line">   java.lang.Thread.State: RUNNABLE</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Finalizer"</span> <span class="comment">#3 daemon prio=8 os_prio=1 tid=0x00000000198f0800 nid=0x35c0 in Object.wait() [0x0000000019dcf000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x00000000d5f08ec0&gt; (a java.lang.ref.ReferenceQueue<span class="variable">$Lock</span>)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143)</span><br><span class="line">        - locked &lt;0x00000000d5f08ec0&gt; (a java.lang.ref.ReferenceQueue<span class="variable">$Lock</span>)</span><br><span class="line">        at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164)</span><br><span class="line">        at java.lang.ref.Finalizer<span class="variable">$FinalizerThread</span>.run(Finalizer.java:209)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"Reference Handler"</span> <span class="comment">#2 daemon prio=10 os_prio=2 tid=0x0000000002a8a000 nid=0x4510 in Object.wait() [0x00000000198ce000]</span></span><br><span class="line">   java.lang.Thread.State: WAITING (on object monitor)</span><br><span class="line">        at java.lang.Object.wait(Native Method)</span><br><span class="line">        - waiting on &lt;0x00000000d5f06b68&gt; (a java.lang.ref.Reference<span class="variable">$Lock</span>)</span><br><span class="line">        at java.lang.Object.wait(Object.java:502)</span><br><span class="line">        at java.lang.ref.Reference.tryHandlePending(Reference.java:191)</span><br><span class="line">        - locked &lt;0x00000000d5f06b68&gt; (a java.lang.ref.Reference<span class="variable">$Lock</span>)</span><br><span class="line">        at java.lang.ref.Reference<span class="variable">$ReferenceHandler</span>.run(Reference.java:153)</span><br><span class="line"></span><br><span class="line">   Locked ownable synchronizers:</span><br><span class="line">        - None</span><br><span class="line"></span><br><span class="line"><span class="string">"VM Thread"</span> os_prio=2 tid=0x0000000017a09000 nid=0x4e20 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#0 (ParallelGC)"</span> os_prio=0 tid=0x00000000029a9000 nid=0x3b2c runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#1 (ParallelGC)"</span> os_prio=0 tid=0x00000000029aa800 nid=0x1918 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#2 (ParallelGC)"</span> os_prio=0 tid=0x00000000029ac000 nid=0x547c runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#3 (ParallelGC)"</span> os_prio=0 tid=0x00000000029ad800 nid=0x8f8 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#4 (ParallelGC)"</span> os_prio=0 tid=0x00000000029b1000 nid=0x56b8 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#5 (ParallelGC)"</span> os_prio=0 tid=0x00000000029b2000 nid=0x3fd8 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#6 (ParallelGC)"</span> os_prio=0 tid=0x00000000029b5000 nid=0x3f74 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"GC task thread#7 (ParallelGC)"</span> os_prio=0 tid=0x00000000029b6800 nid=0x3a08 runnable</span><br><span class="line"></span><br><span class="line"><span class="string">"VM Periodic Task Thread"</span> os_prio=2 tid=0x0000000019b2e800 nid=0x78c waiting on condition</span><br><span class="line"></span><br><span class="line">JNI global references: 17</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Found one Java-level deadlock:</span><br><span class="line">=============================</span><br><span class="line"><span class="string">"Thread-3"</span>:</span><br><span class="line">  waiting to lock monitor 0x0000000017a13728 (object 0x00000000d60b7e90, a java.lang.Object),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">"Thread-1"</span></span><br><span class="line"><span class="string">"Thread-1"</span>:</span><br><span class="line">  waiting to lock monitor 0x0000000017a12288 (object 0x00000000d60b7e80, a java.lang.Object),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">"Thread-0"</span></span><br><span class="line"><span class="string">"Thread-0"</span>:</span><br><span class="line">  waiting to lock monitor 0x0000000017a13728 (object 0x00000000d60b7e90, a java.lang.Object),</span><br><span class="line">  <span class="built_in">which</span> is held by <span class="string">"Thread-1"</span></span><br><span class="line"></span><br><span class="line">Java stack information <span class="keyword">for</span> the threads listed above:</span><br><span class="line">===================================================</span><br><span class="line"><span class="string">"Thread-3"</span>:</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:13)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"><span class="string">"Thread-1"</span>:</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:19)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e80&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"><span class="string">"Thread-0"</span>:</span><br><span class="line">        at priv.shen.javassist.Task.run(Task.java:19)</span><br><span class="line">        - waiting to lock &lt;0x00000000d60b7e90&gt; (a java.lang.Object)</span><br><span class="line">        - locked &lt;0x00000000d60b7e80&gt; (a java.lang.Object)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br><span class="line">Found 1 deadlock.</span><br></pre></td></tr></table></figure></p>
<p>如果发生了死锁，可以在最后查看分析结果来排查死锁原因。</p>
<h1 id="图形工具"><a href="#图形工具" class="headerlink" title="图形工具"></a>图形工具</h1><p>JDK自带的jconsle.exe和jvisualvm.exe这两个图形化工具，是将上述的命令工具可视化了，很容易上手，这里不做过多介绍。</p>

        </div>
      </div>
    </div>
  </div>
</article>



    <!-- Footer -->
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <p class="copyright text-muted">
          Theme By <a target="_blank" href="https://github.com/levblanc">Levblanc.</a>
          Inspired By <a target="_blank" href="https://github.com/klugjo/hexo-theme-clean-blog">Clean Blog.</a>
        <p class="copyright text-muted">
          Powered By <a target="_blank" href="https://hexo.io/">Hexo.</a>
        </p>
      </div>
    </div>
  </div>
</footer>


    <!-- After Footer Scripts -->
<script src="/js/highlight.pack.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var codeBlocks = Array.prototype.slice.call(document.getElementsByTagName('pre'))
    codeBlocks.forEach(function(block, index) {
      hljs.highlightBlock(block);
    });
  });
</script>

  </body>
</html>

