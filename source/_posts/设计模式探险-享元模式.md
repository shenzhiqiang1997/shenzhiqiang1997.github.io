---
title: 设计模式探险-享元模式
date: 2018-09-03 12:00:00
tags: 
    - 设计模式
    - Java
categories: 
    - 设计模式
---
# 享元模式
## 什么是享元模式
通过共享享元对象的内部状态复用大量细颗粒对象，从而节省内存。
<!-- more -->
## 概念
内部状态：享元对象中可以共享的属性，不会因外部环境的影响而改变。  
外部状态：享元对象中不可以共享的属性，会因外部环境的影响而改变。
## 实现方式
享元接口暴露外部状态的操作入口，使得客户端可以改变享元对象的外部状态。具体享元类实现享元接口并负责封装共享的内部状态。享元工厂内含一个map存放享元对象，客户端通过工厂获取享元对象，若有对应享元对象则返回，否则创建新的享元对象。
## 实现代码
```java
/* 享元接口 暴露外部状态的操作入口 */
public interface FlyWeight {
    void operate(String extrinsicState);
}

/* 具体的享元类 封装内部状态 并实现享元接口 */
public class ConcreteFlyWeight implements FlyWeight {
    private String intrinsicState;

    public ConcreteFlyWeight(String intrinsicState){
        this.intrinsicState = intrinsicState;
    }

    @Override
    public void operate(String extrinsicState) {
        System.out.println("intrinsicState:"+intrinsicState);
        System.out.println("extrinsicState:"+extrinsicState);
    }
}

/* 享元工厂 为客户端提供享元对象 */
public class FlyWeightFactory {
    private Map<String,FlyWeight> flyWeights = new HashMap<>();
    public FlyWeight getFlyWeight(String intrinsicState){
        FlyWeight flyWeight = flyWeights.get(intrinsicState);
        if (flyWeight == null){
            flyWeight = new ConcreteFlyWeight(intrinsicState);
            flyWeights.put(intrinsicState,flyWeight);
        }
        return flyWeight;
    }
}

/* 客户端复用了 flyWeight享元对象 */
public class FlyWeightTest {
    public static void main(String[] args) {
        FlyWeightFactory flyWeightFactory = new FlyWeightFactory();
        FlyWeight flyWeight = flyWeightFactory.getFlyWeight("flyWeight");
        flyWeight.operate("A");
        flyWeight.operate("B");
    }
}

```
